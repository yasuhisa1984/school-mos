!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(O,k){"use strict";if(!O.jstree){var e,t,s=0,n=!1,a=!1,o=!1,r=[],i=O("script:last").attr("src"),d=document,v=d.createElement("LI");v.setAttribute("role","treeitem"),(e=d.createElement("I")).className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),v.appendChild(e),(e=d.createElement("A")).className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),(t=d.createElement("I")).className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),v.appendChild(e),e=t=null,O.jstree={version:"3.0.9",defaults:{plugins:[]},plugins:{},path:i&&-1!==i.indexOf("/")?i.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g},O.jstree.create=function(e,i){var r=new O.jstree.core(++s),t=i;return i=O.extend(!0,{},O.jstree.defaults,i),t&&t.plugins&&(i.plugins=t.plugins),O.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),r.init(e,i),r},O.jstree.destroy=function(){O(".jstree:jstree").jstree("destroy"),O(document).off(".jstree")},O.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},O.jstree.reference=function(t){var i=null,e=null;if(t&&t.id&&(t=t.id),!e||!e.length)try{e=O(t)}catch(a){}if(!e||!e.length)try{e=O("#"+t.replace(O.jstree.idregex,"\\$&"))}catch(a){}return e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))?i=e:O(".jstree").each(function(){var e=O(this).data("jstree");return e&&e._model.data[t]?(i=e,!1):void 0}),i},O.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var e=O.jstree.reference(this),t=r&&e?e[i]:null;return n=r&&t?t.apply(e,s):null,e||r||i!==k&&!O.isPlainObject(i)||O(this).data("jstree",new O.jstree.create(this,i)),(e&&!r||!0===i)&&(n=e||!1),(null===n||n===k)&&void 0}),null!==n&&n!==k?n:this)},O.expr[":"].jstree=O.expr.createPseudo(function(){return function(e){return O(e).hasClass("jstree")&&O(e).data("jstree")!==k}}),O.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:O.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},O.jstree.core.prototype={plugin:function(e,t){var i=O.jstree.plugins[e];return i?(this._data[e]={},i.prototype=this,new i(t,this)):this},init:function(e,t){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=O(e).addClass("jstree jstree-"+this._id),this.settings=t,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(k){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var n="",a=null,t=0;this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(n){}}}).on("mousedown.jstree",O.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),t=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",O.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",O.proxy(function(e){this.settings.core.dblclick_toggle&&this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",O.proxy(function(e){e.preventDefault(),e.currentTarget!==document.activeElement&&O(e.currentTarget).focus(),this.activate_node(e.currentTarget,e)},this)).on("keydown.jstree",".jstree-anchor",O.proxy(function(e){if("INPUT"===e.target.tagName)return!0;var t=null;switch(this._data.core.rtl&&(37===e.which?e.which=39:39===e.which&&(e.which=37)),e.which){case 32:e.ctrlKey&&(e.type="click",O(e.currentTarget).trigger(e));break;case 13:e.type="click",O(e.currentTarget).trigger(e);break;case 37:e.preventDefault(),this.is_open(e.currentTarget)?this.close_node(e.currentTarget):(t=this.get_parent(e.currentTarget))&&"#"!==t.id&&this.get_node(t,!0).children(".jstree-anchor").focus();break;case 38:e.preventDefault(),(t=this.get_prev_dom(e.currentTarget))&&t.length&&t.children(".jstree-anchor").focus();break;case 39:e.preventDefault(),this.is_closed(e.currentTarget)?this.open_node(e.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(e.currentTarget)&&((t=this.get_node(e.currentTarget,!0).children(".jstree-children")[0])&&O(this._firstChild(t)).children(".jstree-anchor").focus());break;case 40:e.preventDefault(),(t=this.get_next_dom(e.currentTarget))&&t.length&&t.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:e.preventDefault(),(t=this._firstChild(this.get_container_ul()[0]))&&O(t).children(".jstree-anchor").filter(":visible").focus();break;case 35:e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",O.proxy(function(e,t){t.status&&("#"!==t.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(O.proxy(function(){if(!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var e,t,i=[];for(e=0,t=this._data.core.selected.length;e<t;e++)i=i.concat(this._model.data[this._data.core.selected[e]].parents);for(e=0,t=(i=O.vakata.array_unique(i)).length;e<t;e++)this.open_node(i[e],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",O.proxy(function(e){if("INPUT"===e.target.tagName)return!0;a&&clearTimeout(a),a=setTimeout(function(){n=""},500);var i=String.fromCharCode(e.which).toLowerCase(),t=this.element.find(".jstree-anchor").filter(":visible"),r=t.index(document.activeElement)||0,s=!1;if(1<(n+=i).length){if(t.slice(r).each(O.proxy(function(e,t){return 0===O(t).text().toLowerCase().indexOf(n)?(O(t).focus(),s=!0,!1):void 0},this)),s)return;if(t.slice(0,r).each(O.proxy(function(e,t){return 0===O(t).text().toLowerCase().indexOf(n)?(O(t).focus(),s=!0,!1):void 0},this)),s)return}if(new RegExp("^"+i+"+$").test(n)){if(t.slice(r+1).each(O.proxy(function(e,t){return O(t).text().toLowerCase().charAt(0)===i?(O(t).focus(),s=!0,!1):void 0},this)),s)return;if(t.slice(0,r+1).each(O.proxy(function(e,t){return O(t).text().toLowerCase().charAt(0)===i?(O(t).focus(),s=!0,!1):void 0},this)),s)return}},this)).on("init.jstree",O.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",O.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",O.proxy(function(e){this._data.core.focused=null,O(e.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",O.proxy(function(e){var t=this.get_node(e.currentTarget);t&&t.id&&(this._data.core.focused=t.id),this.element.find(".jstree-hovered").not(e.currentTarget).mouseleave(),O(e.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",O.proxy(function(){500<+new Date-t&&!this._data.core.focused&&(t=0,this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus())},this)).on("mouseenter.jstree",".jstree-anchor",O.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",O.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),O(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),(t.instance=this).element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(e){var t=this.settings.core.strings;return O.isFunction(t)?t.call(this,e):t&&t[e]?t[e]:e},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(e,t){var i;e&&e.id&&(e=e.id);try{if(this._model.data[e])e=this._model.data[e];else if("string"==typeof e&&this._model.data[e.replace(/^#/,"")])e=this._model.data[e.replace(/^#/,"")];else if("string"==typeof e&&(i=O("#"+e.replace(O.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else if((i=O(e,this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=O(e,this.element)).length||!i.hasClass("jstree"))return!1;e=this._model.data["#"]}return t&&(e="#"===e.id?this.element:O("#"+e.id.replace(O.jstree.idregex,"\\$&"),this.element)),e}catch(a){return!1}},get_path:function(e,t,i){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var r,s,n=[];for(n.push(i?e.id:e.text),r=0,s=e.parents.length;r<s;r++)n.push(i?e.parents[r]:this.get_text(e.parents[r]));return n=n.reverse().slice(1),t?n.join(t):n},get_next_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this._firstChild(this.get_container_ul()[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);return!!i&&O(i)}if(!e||!e.length)return!1;if(t){for(i=e[0];(i=this._nextSibling(i))&&0===i.offsetHeight;);return!!i&&O(i)}if(e.hasClass("jstree-open")){for(i=this._firstChild(e.children(".jstree-children")[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);if(null!==i)return O(i)}for(i=e[0];(i=this._nextSibling(i))&&0===i.offsetHeight;);return null!==i?O(i):e.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this.get_container_ul()[0].lastChild;i&&0===i.offsetHeight;)i=this._previousSibling(i);return!!i&&O(i)}if(!e||!e.length)return!1;if(t){for(i=e[0];(i=this._previousSibling(i))&&0===i.offsetHeight;);return!!i&&O(i)}for(i=e[0];(i=this._previousSibling(i))&&0===i.offsetHeight;);if(null!==i){for(e=O(i);e.hasClass("jstree-open");)e=e.children(".jstree-children").first().children(".jstree-node:visible:last");return e}return!(!(i=e[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&O(i)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||0<e.children.length)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(i,r){var e,t,s,n,a;if(O.isArray(i))return this._load_nodes(i.slice(),r),!0;if(!(i=this.get_node(i)))return r&&r.call(this,i,!1),!1;if(i.state.loaded){for(i.state.loaded=!1,e=0,t=i.children_d.length;e<t;e++){for(s=0,n=i.parents.length;s<n;s++)this._model.data[i.parents[s]].children_d=O.vakata.array_remove_item(this._model.data[i.parents[s]].children_d,i.children_d[e]);this._model.data[i.children_d[e]].state.selected&&(a=!0,this._data.core.selected=O.vakata.array_remove_item(this._data.core.selected,i.children_d[e])),delete this._model.data[i.children_d[e]]}i.children=[],i.children_d=[],a&&this.trigger("changed",{action:"load_node",node:i,selected:this._data.core.selected})}return i.state.loading=!0,this.get_node(i,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(i,O.proxy(function(e){(i=this._model.data[i.id]).state.loading=!1,i.state.loaded=e;var t=this.get_node(i,!0);i.state.loaded&&!i.children.length&&t&&t.length&&!t.hasClass("jstree-leaf")&&t.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),t.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:i,status:e}),r&&r.call(this,i,e)},this)),!0},_load_nodes:function(e,t,i){var r,s,n=!0,a=function(){this._load_nodes(e,t,!0)},o=this._model.data;for(r=0,s=e.length;r<s;r++)!o[e[r]]||o[e[r]].state.loaded&&i||(this.is_loading(e[r])||this.load_node(e[r],a),n=!1);n&&t&&!t.done&&(t.call(this,e),t.done=!0)},load_all:function(e,t){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,s=[],n=this._model.data,a=n[e.id].children_d;for(e.state&&!e.state.loaded&&s.push(e.id),i=0,r=a.length;i<r;i++)n[a[i]]&&n[a[i]].state&&!n[a[i]].state.loaded&&s.push(a[i]);s.length?this._load_nodes(s,function(){this.load_all(e,t)}):(t&&t.call(this,e),this.trigger("load_all",{node:e}))},_load_node:function(s,n){var e,t=this.settings.core.data;return t?O.isFunction(t)?t.call(this,s,O.proxy(function(e){!1===e&&n.call(this,!1),this["string"==typeof e?"_append_html_data":"_append_json_data"](s,"string"==typeof e?O(e):e,function(e){n.call(this,e)})},this)):"object"==typeof t?t.url?(t=O.extend(!0,{},t),O.isFunction(t.url)&&(t.url=t.url.call(this,s)),O.isFunction(t.data)&&(t.data=t.data.call(this,s)),O.ajax(t).done(O.proxy(function(e,t,i){var r=i.getResponseHeader("Content-Type");return-1!==r.indexOf("json")||"object"==typeof e?this._append_json_data(s,e,function(e){n.call(this,e)}):-1!==r.indexOf("html")||"string"==typeof e?this._append_html_data(s,O(e),function(e){n.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:s.id,xhr:i})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(O.proxy(function(e){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:s.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(e=O.isArray(t)||O.isPlainObject(t)?JSON.parse(JSON.stringify(t)):t,"#"===s.id?this._append_json_data(s,e,function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:s.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):"string"==typeof t?"#"===s.id?this._append_html_data(s,O(t),function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:s.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):"#"===s.id?this._append_html_data(s,this._data.core.original_container_html.clone(!0),function(e){n.call(this,e)}):n.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(e,t,i){(e=this.get_node(e)).children=[],e.children_d=[];var r,s,n,a=t.is("ul")?t.children():t,o=e.id,d=[],c=[],l=this._model.data,h=l[o],_=this._data.core.selected.length;for(a.each(O.proxy(function(e,t){(r=this._parse_model_from_html(O(t),o,h.parents.concat()))&&(d.push(r),c.push(r),l[r].children_d.length&&(c=c.concat(l[r].children_d)))},this)),h.children=d,h.children_d=c,s=0,n=h.parents.length;s<n;s++)l[h.parents[s]].children_d=l[h.parents[s]].children_d.concat(c);this.trigger("model",{nodes:c,parent:o}),"#"!==o?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==_&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(t,e,d,i){(t=this.get_node(t)).children=[],t.children_d=[],e.d&&("string"==typeof(e=e.d)&&(e=JSON.parse(e))),O.isArray(e)||(e=[e]);var r=null,s={df:this._model.default_state,dat:e,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},n=function(e,c){e.data&&(e=e.data);var t,i,r,s,n=e.dat,a=e.par,o=[],d=[],l=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[a],p=e.sel,m=function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);var r,s,n,a,o=e.id.toString(),d={id:o,text:e.text||"",icon:e.icon===c||e.icon,parent:t,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in h)h.hasOwnProperty(r)&&(d.state[r]=h[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),e&&e.data&&(d.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(d.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(d.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(d.li_attr[r]=e.li_attr[r]);if(d.li_attr.id||(d.li_attr.id=o),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(d.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),r=0,s=(g[d.id]=d).children.length;r<s;r++)n=m(g[d.children[r]],d.id,i),a=g[n],d.children_d.push(n),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d));return delete e.data,delete e.children,g[d.id].original=e,d.state.selected&&l.push(d.id),d.id},v=function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);for(var r,s,n,a,o,d=!1;d="j"+_+"_"+ ++u,g[d];);for(r in o={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===c||e.icon,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},h)h.hasOwnProperty(r)&&(o.state[r]=h[r]);if(e&&e.id&&(o.id=e.id.toString()),e&&e.text&&(o.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(o.icon=e.data.jstree.icon),e&&e.data&&(o.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(o.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(o.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(o.li_attr[r]=e.li_attr[r]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=d),o.li_attr.id||(o.li_attr.id=o.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(o.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++)n=v(e.children[r],o.id,i),a=g[n],o.children.push(n),a.children_d.length&&(o.children_d=o.children_d.concat(a.children_d));o.children_d=o.children_d.concat(o.children)}return e&&e.children&&!0===e.children&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete e.data,delete e.children,o.original=e,(g[o.id]=o).state.selected&&l.push(o.id),o.id};if(n.length&&n[0].id!==c&&n[0].parent!==c){for(i=0,r=n.length;i<r;i++)n[i].children||(n[i].children=[]),g[n[i].id.toString()]=n[i];for(i=0,r=n.length;i<r;i++)g[n[i].parent.toString()].children.push(n[i].id.toString()),f.children_d.push(n[i].id.toString());for(i=0,r=f.children.length;i<r;i++)t=m(g[f.children[i]],a,f.parents.concat()),d.push(t),g[t].children_d.length&&(d=d.concat(g[t].children_d));for(i=0,r=f.parents.length;i<r;i++)g[f.parents[i]].children_d=g[f.parents[i]].children_d.concat(d);s={cnt:u,mod:g,sel:p,par:a,dpc:d,add:l}}else{for(i=0,r=n.length;i<r;i++)(t=v(n[i],a,f.parents.concat()))&&(o.push(t),d.push(t),g[t].children_d.length&&(d=d.concat(g[t].children_d)));for(f.children=o,f.children_d=d,i=0,r=f.parents.length;i<r;i++)g[f.parents[i]].children_d=g[f.parents[i]].children_d.concat(d);s={cnt:u,mod:g,sel:p,par:a,dpc:d,add:l}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?s:void postMessage(s)},a=function(e,t){if(this._cnt=e.cnt,this._model.data=e.mod,t){var i,r,s=e.add,n=e.sel,a=this._data.core.selected.slice(),o=this._model.data;if(n.length!==a.length||O.vakata.array_unique(n.concat(a)).length!==n.length){for(i=0,r=n.length;i<r;i++)-1===O.inArray(n[i],s)&&-1===O.inArray(n[i],a)&&(o[n[i]].state.selected=!1);for(i=0,r=a.length;i<r;i++)-1===O.inArray(a[i],n)&&(o[a[i]].state.selected=!0)}}e.add.length&&(this._data.core.selected=this._data.core.selected.concat(e.add)),this.trigger("model",{nodes:e.dpc,parent:e.par}),"#"!==e.par?(this._node_changed(e.par),this.redraw()):this.redraw(!0),e.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),d.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+n.toString()],{type:"text/javascript"}))),!this._data.core.working||i?(this._data.core.working=!0,(r=new window.Worker(this._wrk)).onmessage=O.proxy(function(e){a.call(this,e.data,!0);try{r.terminate(),r=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),s.par?r.postMessage(s):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,e,d,!0])}catch(v){a.call(this,n(s),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else a.call(this,n(s),!1)},_parse_model_from_html:function(e,t,i){i=i?[].concat(i):[],t&&i.unshift(t);var r,s,n,a,o,d=this._model.data,c={id:!1,text:!1,icon:!0,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in this._model.default_state)this._model.default_state.hasOwnProperty(n)&&(c.state[n]=this._model.default_state[n]);if(a=O.vakata.attributes(e,!0),O.each(a,function(e,t){return!(t=O.trim(t)).length||(c.li_attr[e]=t,void("id"===e&&(c.id=t.toString())))}),(a=e.children("a").first()).length&&(a=O.vakata.attributes(a,!0),O.each(a,function(e,t){(t=O.trim(t)).length&&(c.a_attr[e]=t)})),(a=e.children("a").first().length?e.children("a").first().clone():e.clone()).children("ins, i, ul").remove(),a=a.html(),a=O("<div />").html(a),c.text=this.settings.core.force_text?a.text():a.html(),a=e.data(),c.data=a?O.extend(!0,{},a):null,c.state.opened=e.hasClass("jstree-open"),c.state.selected=e.children("a").hasClass("jstree-clicked"),c.state.disabled=e.children("a").hasClass("jstree-disabled"),c.data&&c.data.jstree)for(n in c.data.jstree)c.data.jstree.hasOwnProperty(n)&&(c.state[n]=c.data.jstree[n]);for((a=e.children("a").children(".jstree-themeicon")).length&&(c.icon=!a.hasClass("jstree-themeicon-hidden")&&a.attr("rel")),c.state.icon&&(c.icon=c.state.icon),a=e.children("ul").children("li");d[o="j"+this._id+"_"+ ++this._cnt];);return c.id=c.li_attr.id?c.li_attr.id.toString():o,a.length?(a.each(O.proxy(function(e,t){r=this._parse_model_from_html(O(t),c.id,i),s=this._model.data[r],c.children.push(r),s.children_d.length&&(c.children_d=c.children_d.concat(s.children_d))},this)),c.children_d=c.children_d.concat(c.children)):e.hasClass("jstree-closed")&&(c.state.loaded=!1),c.li_attr["class"]&&(c.li_attr["class"]=c.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),c.a_attr["class"]&&(c.a_attr["class"]=c.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),(d[c.id]=c).state.selected&&this._data.core.selected.push(c.id),c.id},_parse_model_from_flat_json:function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);var r,s,n,a,o=e.id.toString(),d=this._model.data,c=this._model.default_state,l={id:o,text:e.text||"",icon:e.icon===k||e.icon,parent:t,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in c)c.hasOwnProperty(r)&&(l.state[r]=c[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id||(l.li_attr.id=o),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),r=0,s=(d[l.id]=l).children.length;r<s;r++)a=d[n=this._parse_model_from_flat_json(d[l.children[r]],l.id,i)],l.children_d.push(n),a.children_d.length&&(l.children_d=l.children_d.concat(a.children_d));return delete e.data,delete e.children,d[l.id].original=e,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);for(var r,s,n,a,o,d=!1,c=this._model.data,l=this._model.default_state;c[d="j"+this._id+"_"+ ++this._cnt];);for(r in o={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===k||e.icon,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},l)l.hasOwnProperty(r)&&(o.state[r]=l[r]);if(e&&e.id&&(o.id=e.id.toString()),e&&e.text&&(o.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(o.icon=e.data.jstree.icon),e&&e.data&&(o.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(o.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(o.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(o.li_attr[r]=e.li_attr[r]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=d),o.li_attr.id||(o.li_attr.id=o.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(o.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++)a=c[n=this._parse_model_from_json(e.children[r],o.id,i)],o.children.push(n),a.children_d.length&&(o.children_d=o.children_d.concat(a.children_d));o.children_d=o.children_d.concat(o.children)}return e&&e.children&&!0===e.children&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete e.data,delete e.children,o.original=e,(c[o.id]=o).state.selected&&this._data.core.selected.push(o.id),o.id},_redraw:function(){var e,t,i,r=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),s=document.createElement("UL"),n=this._data.core.focused;for(t=0,i=r.length;t<i;t++)(e=this.redraw_node(r[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&s.appendChild(e);this._model.force_full_redraw&&(s.className=this.get_container_ul()[0].className,s.setAttribute("role","group"),this.element.empty().append(s)),null!==n&&((e=this.get_node(n,!0))&&e.length&&e.children(".jstree-anchor")[0]!==document.activeElement?e.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:r})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(e){var t=this.get_node(e),i=!1,r=!1,s=!1,n=document;if(!t)return!1;if("#"===t.id)return this.redraw(!0);if(!(e=this.get_node(e,!0))||!e.length)return!1;if(e.children(".jstree-children").remove(),e=e[0],t.children.length&&t.state.loaded){for((s=n.createElement("UL")).setAttribute("role","group"),s.className="jstree-children",i=0,r=t.children.length;i<r;i++)s.appendChild(this.redraw_node(t.children[i],!0,!0));e.appendChild(s)}},redraw_node:function(e,t,i,r){var s=this.get_node(e),n=!1,a=!1,o=!1,d=!1,c=!1,l=!1,h="",_=document,u=this._model.data,g=!1,f=null,p=0,m=0;if(!s)return!1;if("#"===s.id)return this.redraw(!0);if(t=t||0===s.children.length,e=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(s.id[0])?"\\3"+s.id[0]+" "+s.id.substr(1).replace(O.jstree.idregex,"\\$&"):s.id.replace(O.jstree.idregex,"\\$&"))):document.getElementById(s.id))e=O(e),i||((n=e.parent().parent()[0])===this.element[0]&&(n=null),a=e.index()),t||!s.children.length||e.children(".jstree-children").length||(t=!0),t||(o=e.children(".jstree-children")[0]),g=e.children(".jstree-anchor")[0]===document.activeElement,e.remove();else if(t=!0,!i){if(!(null===(n="#"!==s.parent?O("#"+s.parent.replace(O.jstree.idregex,"\\$&"),this.element)[0]:null)||n&&u[s.parent].state.opened))return!1;a=O.inArray(s.id,null===n?u["#"].children:u[s.parent].children)}for(d in e=v.cloneNode(!0),h="jstree-node ",s.li_attr)if(s.li_attr.hasOwnProperty(d)){if("id"===d)continue;"class"!==d?e.setAttribute(d,s.li_attr[d]):h+=s.li_attr[d]}for(c in s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),e.setAttribute("aria-selected",!!s.state.selected),e.setAttribute("aria-level",s.parents.length),e.setAttribute("aria-labelledby",s.a_attr.id),s.state.disabled&&e.setAttribute("aria-disabled",!0),s.state.loaded&&!s.children.length?h+=" jstree-leaf":(h+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",e.setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),null!==s.parent&&u[s.parent].children[u[s.parent].children.length-1]===s.id&&(h+=" jstree-last"),e.id=s.id,e.className=h,h=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":""),s.a_attr)if(s.a_attr.hasOwnProperty(c)){if("href"===c&&"#"===s.a_attr[c])continue;"class"!==c?e.childNodes[1].setAttribute(c,s.a_attr[c]):h+=" "+s.a_attr[c]}if(h.length&&(e.childNodes[1].className="jstree-anchor "+h),(s.icon&&!0!==s.icon||!1===s.icon)&&(!1===s.icon?e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===s.icon.indexOf("/")&&-1===s.icon.indexOf(".")?e.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(e.childNodes[1].childNodes[0].style.backgroundImage="url("+s.icon+")",e.childNodes[1].childNodes[0].style.backgroundPosition="center center",e.childNodes[1].childNodes[0].style.backgroundSize="auto",e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?e.childNodes[1].appendChild(_.createTextNode(s.text)):e.childNodes[1].innerHTML+=s.text,t&&s.children.length&&(s.state.opened||r)&&s.state.loaded){for((l=_.createElement("UL")).setAttribute("role","group"),l.className="jstree-children",
d=0,c=s.children.length;d<c;d++)l.appendChild(this.redraw_node(s.children[d],t,!0));e.appendChild(l)}if(o&&e.appendChild(o),!i){for(n||(n=this.element[0]),d=0,c=n.childNodes.length;d<c;d++)if(n.childNodes[d]&&n.childNodes[d].className&&-1!==n.childNodes[d].className.indexOf("jstree-children")){f=n.childNodes[d];break}f||((f=_.createElement("UL")).setAttribute("role","group"),f.className="jstree-children",n.appendChild(f)),a<(n=f).childNodes.length?n.insertBefore(e,n.childNodes[a]):n.appendChild(e),g&&(p=this.element[0].scrollTop,m=this.element[0].scrollLeft,e.childNodes[1].focus(),this.element[0].scrollTop=p,this.element[0].scrollLeft=m)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(O.proxy(function(){this.open_node(s.id,!1,0)},this),0)),e},open_node:function(e,i,r){var t,s,n,a;if(O.isArray(e)){for(t=0,s=(e=e.slice()).length;t<s;t++)this.open_node(e[t],i,r);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;if(r=r===k?this.settings.core.animation:r,!this.is_closed(e))return i&&i.call(this,e,!1),!1;if(this.is_loaded(e))n=this.get_node(e,!0),a=this,n.length&&(r&&n.children(".jstree-children").length&&n.children(".jstree-children").stop(!0,!0),e.children.length&&!this._firstChild(n.children(".jstree-children")[0])&&this.draw_children(e),r?(this.trigger("before_open",{node:e}),n.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(r,function(){this.style.display="",a.trigger("after_open",{node:e})})):(this.trigger("before_open",{node:e}),n[0].className=n[0].className.replace("jstree-closed","jstree-open"),n[0].setAttribute("aria-expanded",!0))),e.state.opened=!0,i&&i.call(this,e,!0),n.length||this.trigger("before_open",{node:e}),this.trigger("open_node",{node:e}),r&&n.length||this.trigger("after_open",{node:e});else{if(this.is_loading(e))return setTimeout(O.proxy(function(){this.open_node(e,i,r)},this),500);this.load_node(e,function(e,t){return t?this.open_node(e,i,r):!!i&&i.call(this,e,!1)})}},_open_to:function(e){if(!(e=this.get_node(e))||"#"===e.id)return!1;var t,i,r=e.parents;for(t=0,i=r.length;t<i;t+=1)"#"!==t&&this.open_node(r[t],!1,0);return O("#"+e.id.replace(O.jstree.idregex,"\\$&"),this.element)},close_node:function(e,t){var i,r,s,n;if(O.isArray(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.close_node(e[i],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(!this.is_closed(e)&&(t=t===k?this.settings.core.animation:t,(n=(s=this).get_node(e,!0)).length&&(t?n.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(t,function(){this.style.display="",n.children(".jstree-children").remove(),s.trigger("after_close",{node:e})}):(n[0].className=n[0].className.replace("jstree-open","jstree-closed"),n.attr("aria-expanded",!1).children(".jstree-children").remove())),e.state.opened=!1,this.trigger("close_node",{node:e}),void(t&&n.length||this.trigger("after_close",{node:e}))))},toggle_node:function(e){var t,i;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.toggle_node(e[t]);return!0}return this.is_closed(e)?this.open_node(e):this.is_open(e)?this.close_node(e):void 0},open_all:function(e,i,r){if(e||(e="#"),!(e=this.get_node(e)))return!1;var t,s,n,a="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!a.length){for(t=0,s=e.children_d.length;t<s;t++)this.is_closed(this._model.data[e.children_d[t]])&&(this._model.data[e.children_d[t]].state.opened=!0);return this.trigger("open_all",{node:e})}r=r||a,(a=(n=this).is_closed(e)?a.find(".jstree-closed").addBack():a.find(".jstree-closed")).each(function(){n.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(e,t){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,s="#"===e.id?this.get_container_ul():this.get_node(e,!0),n=this;if(!s.length){for(i=0,r=e.children_d.length;i<r;i++)this._model.data[e.children_d[i]].state.opened=!1;return this.trigger("close_all",{node:e})}s=this.is_open(e)?s.find(".jstree-open").addBack():s.find(".jstree-open"),O(s.get().reverse()).each(function(){n.close_node(this,t||0)}),this.trigger("close_all",{node:e})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(e){var t,i;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.enable_node(e[t]);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(e.state.disabled=!1,this.get_node(e,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:e}))},disable_node:function(e){var t,i;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.disable_node(e[t]);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(e.state.disabled=!0,this.get_node(e,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:e}))},activate_node:function(e,t){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==k?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&(!t.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(t.shiftKey){var i,r,s=this.get_node(e).id,n=this._data.core.last_clicked.id,a=this.get_node(this._data.core.last_clicked.parent).children,o=!1;for(i=0,r=a.length;i<r;i+=1)a[i]===s&&(o=!o),a[i]===n&&(o=!o),o||a[i]===s||a[i]===n?this.select_node(a[i],!0,!1,t):this.deselect_node(a[i],!0,t);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:t})}else this.is_selected(e)?this.deselect_node(e,!1,t):this.select_node(e,!1,!1,t);else!this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,t):(this.deselect_all(!0),this.select_node(e,!1,!1,t),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(e,t,i,r){var s,n,a;if(O.isArray(e)){for(n=0,a=(e=e.slice()).length;n<a;n++)this.select_node(e[n],t,i,r);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(s=this.get_node(e,!0),void(e.state.selected||(e.state.selected=!0,this._data.core.selected.push(e.id),i||(s=this._open_to(e)),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:e,selected:this._data.core.selected,event:r}),t||this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:r}))))},deselect_node:function(e,t,i){var r,s,n;if(O.isArray(e)){for(r=0,s=(e=e.slice()).length;r<s;r++)this.deselect_node(e[r],t,i);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(n=this.get_node(e,!0),void(e.state.selected&&(e.state.selected=!1,this._data.core.selected=O.vakata.array_remove_item(this._data.core.selected,e.id),n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:i}),t||this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:i}))))},select_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(e){return e?O.map(this._data.core.selected,O.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(e){var t,i,r,s,n=this.get_selected(!0),a={};for(t=0,i=n.length;t<i;t++)a[n[t].id]=n[t];for(t=0,i=n.length;t<i;t++)for(r=0,s=n[t].children_d.length;r<s;r++)a[n[t].children_d[r]]&&delete a[n[t].children_d[r]];for(t in n=[],a)a.hasOwnProperty(t)&&n.push(t);return e?O.map(n,O.proxy(function(e){return this.get_node(e)},this)):n},get_bottom_selected:function(e){var t,i,r=this.get_selected(!0),s=[];for(t=0,i=r.length;t<i;t++)r[t].children.length||s.push(r[t].id);return e?O.map(s,O.proxy(function(e){return this.get_node(e)},this)):s},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(i,r){if(i){if(i.core){var s,n,a;if(i.core.open)return O.isArray(i.core.open)?(s=!0,!1,n=this,O.each(i.core.open.concat([]),function(e,t){n.get_node(t)&&(n.is_loaded(t)?(n.is_closed(t)&&n.open_node(t,!1,0),i&&i.core&&i.core.open&&O.vakata.array_remove_item(i.core.open,t)):(n.is_loading(t)||n.open_node(t,O.proxy(function(e,t){!t&&i&&i.core&&i.core.open&&O.vakata.array_remove_item(i.core.open,e.id),this.set_state(i,r)},n),0),s=!1))}),s&&(delete i.core.open,this.set_state(i,r))):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==k&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==k&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return(a=this).deselect_all(),O.each(i.core.selected,function(e,t){a.select_node(t)}),delete i.core.selected,this.set_state(i,r),!1;if(O.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!O.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(e,t){this._data.core.state=!0===t?{}:this.get_state(),t&&O.isFunction(t)&&(this._data.core.state=t.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;e||(this.element.html("<ul class='"+i+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node("#",function(e,t){t&&(this.get_container_ul()[0].className=i,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(O.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i=[],e=[];this._data.core.selected.concat([]);e.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)}),this._load_nodes(e,O.proxy(function(e){this.open_node(i,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(e,t){if(!(e=this.get_node(e))||"#"===e.id)return!1;var i,r,s=this._model.data;for(t=t.toString(),s[e.parent].children[O.inArray(e.id,s[e.parent].children)]=t,i=0,r=e.parents.length;i<r;i++)s[e.parents[i]].children_d[O.inArray(e.id,s[e.parents[i]].children_d)]=t;for(i=0,r=e.children.length;i<r;i++)s[e.children[i]].parent=t;for(i=0,r=e.children_d.length;i<r;i++)s[e.children_d[i]].parents[O.inArray(e.id,s[e.children_d[i]].parents)]=t;return-1!==(i=O.inArray(e.id,this._data.core.selected))&&(this._data.core.selected[i]=t),(i=this.get_node(e.id,!0))&&i.attr("id",t),delete s[e.id],s[e.id=t]=e,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(e,t){var i,r;if(O.isArray(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.set_text(e[i],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(e.text=t,this.get_node(e,!0).length&&this.redraw_node(e.id),this.trigger("set_text",{obj:e,text:t}),!0)},get_json:function(e,t,i){if(!(e=this.get_node(e||"#")))return!1;t&&t.flat&&!i&&(i=[]);var r,s,n={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:O.extend(!0,{},e.li_attr),a_attr:O.extend(!0,{},e.a_attr),state:{},data:(!t||!t.no_data)&&O.extend(!0,{},e.data)};if(t&&t.flat?n.parent=e.parent:n.children=[],!t||!t.no_state)for(r in e.state)e.state.hasOwnProperty(r)&&(n.state[r]=e.state[r]);if(t&&t.no_id&&(delete n.id,n.li_attr&&n.li_attr.id&&delete n.li_attr.id,n.a_attr&&n.a_attr.id&&delete n.a_attr.id),t&&t.flat&&"#"!==e.id&&i.push(n),!t||!t.no_children)for(r=0,s=e.children.length;r<s;r++)t&&t.flat?this.get_json(e.children[r],t,i):n.children.push(this.get_json(e.children[r],t));return t&&t.flat?i:"#"===e.id?n.children:n},create_node:function(e,t,i,r,s){if(null===e&&(e="#"),!(e=this.get_node(e)))return!1;if(!(i=i===k?"last":i).toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(e))return this.load_node(e,function(){this.create_node(e,t,i,r,!0)});var n,a,o,d;switch(t||(t={text:this.get_string("New node")}),"string"==typeof t&&(t={text:t}),t.text===k&&(t.text=this.get_string("New node")),"#"===e.id&&("before"===i&&(i="first"),"after"===i&&(i="last")),i){case"before":n=this.get_node(e.parent),i=O.inArray(e.id,n.children),e=n;break;case"after":n=this.get_node(e.parent),i=O.inArray(e.id,n.children)+1,e=n;break;case"inside":case"first":i=0;break;case"last":i=e.children.length;break;default:i||(i=0)}if(i>e.children.length&&(i=e.children.length),t.id||(t.id=!0),!this.check("create_node",t,e,i))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===t.id&&delete t.id,!(t=this._parse_model_from_json(t,e.id,e.parents.concat())))return!1;for(n=this.get_node(t),(a=[]).push(t),a=a.concat(n.children_d),this.trigger("model",{nodes:a,parent:e.id}),e.children_d=e.children_d.concat(a),o=0,d=e.parents.length;o<d;o++)this._model.data[e.parents[o]].children_d=this._model.data[e.parents[o]].children_d.concat(a);for(t=n,n=[],o=0,d=e.children.length;o<d;o++)n[i<=o?o+1:o]=e.children[o];return n[i]=t.id,e.children=n,this.redraw_node(e,!0),r&&r.call(this,this.get_node(t)),this.trigger("create_node",{node:this.get_node(t),parent:e.id,position:i}),t.id},rename_node:function(e,t){var i,r,s;if(O.isArray(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.rename_node(e[i],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(s=e.text,this.check("rename_node",e,this.get_parent(e),t)?(this.set_text(e,t),this.trigger("rename_node",{node:e,text:t,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(e){var t,i,r,s,n,a,o,d,c,l;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.delete_node(e[t]);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;if(r=this.get_node(e.parent),s=O.inArray(e.id,r.children),l=!1,!this.check("delete_node",e,r,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==s&&(r.children=O.vakata.array_remove(r.children,s)),(n=e.children_d.concat([])).push(e.id),d=0,c=n.length;d<c;d++){for(a=0,o=e.parents.length;a<o;a++)-1!==(s=O.inArray(n[d],this._model.data[e.parents[a]].children_d))&&(this._model.data[e.parents[a]].children_d=O.vakata.array_remove(this._model.data[e.parents[a]].children_d,s));this._model.data[n[d]].state.selected&&(l=!0,-1!==(s=O.inArray(n[d],this._data.core.selected))&&(this._data.core.selected=O.vakata.array_remove(this._data.core.selected,s)))}for(this.trigger("delete_node",{node:e,parent:r.id}),l&&this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:r.id}),d=0,c=n.length;d<c;d++)delete this._model.data[n[d]];return this.redraw_node(r,!0),!0},check:function(e,t,i,r,s){t=t&&t.id?t:this.get_node(t),i=i&&i.id?i:this.get_node(i);var n=e.match(/^move_node|copy_node|create_node$/i)?i:t,a=this.settings.core.check_callback;return"move_node"!==e&&"copy_node"!==e||s&&s.is_multi||t.id!==i.id&&O.inArray(t.id,i.children)!==r&&-1===O.inArray(i.id,t.children_d)?(n&&n.data&&(n=n.data),n&&n.functions&&(!1===n.functions[e]||!0===n.functions[e])?(!1===n.functions[e]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),n.functions[e]):!(!1===a||O.isFunction(a)&&!1===a.call(this,e,t,i,r,s)||a&&!1===a[e])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(e,t,i,r,s,n){var a,o,d,c,l,h,_,u,g,f,p,m,v,j;if(t=this.get_node(t),i=i===k?0:i,!t)return!1;if(!i.toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(t))return this.load_node(t,function(){this.move_node(e,t,i,r,!0)});if(O.isArray(e)){for(a=0,o=(e=e.slice()).length;a<o;a++)this.move_node(e[a],t,i,r,s,!0)&&(t=e[a],i="after");return this.redraw(),!0}if(!(e=e&&e.id?e:this.get_node(e))||"#"===e.id)return!1;if(d=(e.parent||"#").toString(),l=i.toString().match(/^(before|after)$/)&&"#"!==t.id?this.get_node(t.parent):t,_=!(h=e.instance?e.instance:this._model.data[e.id]?this:O.jstree.reference(e.id))||!h._id||this._id!==h._id,c=h&&h._id&&d&&h._model.data[d]&&h._model.data[d].children?O.inArray(e.id,h._model.data[d].children):-1,_)return!!this.copy_node(e,t,i,r,s)&&(h&&h.delete_node(e),!0);switch("#"===t.id&&("before"===i&&(i="first"),"after"===i&&(i="last")),i){case"before":i=O.inArray(t.id,l.children);break;case"after":i=O.inArray(t.id,l.children)+1;break;case"inside":case"first":i=0;break;case"last":i=l.children.length;break;default:i||(i=0)}if(i>l.children.length&&(i=l.children.length),!this.check("move_node",e,l,i,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(e.parent===l.id){for(u=l.children.concat(),-1!==(g=O.inArray(e.id,u))&&(u=O.vakata.array_remove(u,g),g<i&&i--),g=[],f=0,p=u.length;f<p;f++)g[i<=f?f+1:f]=u[f];g[i]=e.id,l.children=g,this._node_changed(l.id),this.redraw("#"===l.id)}else{for((g=e.children_d.concat()).push(e.id),f=0,p=e.parents.length;f<p;f++){for(u=[],m=0,v=(j=h._model.data[e.parents[f]].children_d).length;m<v;m++)-1===O.inArray(j[m],g)&&u.push(j[m]);h._model.data[e.parents[f]].children_d=u}for(h._model.data[d].children=O.vakata.array_remove_item(h._model.data[d].children,e.id),f=0,p=l.parents.length;f<p;f++)this._model.data[l.parents[f]].children_d=this._model.data[l.parents[f]].children_d.concat(g);for(u=[],f=0,p=l.children.length;f<p;f++)u[i<=f?f+1:f]=l.children[f];for(u[i]=e.id,l.children=u,l.children_d.push(e.id),l.children_d=l.children_d.concat(e.children_d),e.parent=l.id,(g=l.parents.concat()).unshift(l.id),j=e.parents.length,g=(e.parents=g).concat(),f=0,p=e.children_d.length;f<p;f++)this._model.data[e.children_d[f]].parents=this._model.data[e.children_d[f]].parents.slice(0,-1*j),Array.prototype.push.apply(this._model.data[e.children_d[f]].parents,g);("#"===d||"#"===l.id)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(d),this._node_changed(l.id)),n||this.redraw()}return r&&r.call(this,e,l,i),this.trigger("move_node",{node:e,parent:l.id,position:i,old_parent:d,old_position:c,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(e,t,i,r,s,n){var a,o,d,c,l,h,_,u,g,f;if(t=this.get_node(t),i=i===k?0:i,!t)return!1;if(!i.toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(t))return this.load_node(t,function(){this.copy_node(e,t,i,r,!0)});if(O.isArray(e)){for(a=0,o=(e=e.slice()).length;a<o;a++)(c=this.copy_node(e[a],t,i,r,s,!0))&&(t=c,i="after");return this.redraw(),!0}if(!(e=e&&e.id?e:this.get_node(e))||"#"===e.id)return!1;switch(u=(e.parent||"#").toString(),g=i.toString().match(/^(before|after)$/)&&"#"!==t.id?this.get_node(t.parent):t,!(f=e.instance?e.instance:this._model.data[e.id]?this:O.jstree.reference(e.id))||!f._id||this._id!==f._id,"#"===t.id&&("before"===i&&(i="first"),"after"===i&&(i="last")),i){case"before":i=O.inArray(t.id,g.children);break;case"after":i=O.inArray(t.id,g.children)+1;break;case"inside":case"first":i=0;break;case"last":i=g.children.length;break;default:i||(i=0)}if(i>g.children.length&&(i=g.children.length),!this.check("copy_node",e,g,i,{core:!0,is_multi:f&&f._id&&f._id!==this._id,is_foreign:!f||!f._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(_=f?f.get_json(e,{no_id:!0,no_data:!0,no_state:!0}):e))return!1;if(!0===_.id&&delete _.id,!(_=this._parse_model_from_json(_,g.id,g.parents.concat())))return!1;for(c=this.get_node(_),e&&e.state&&!1===e.state.loaded&&(c.state.loaded=!1),(d=[]).push(_),d=d.concat(c.children_d),this.trigger("model",{nodes:d,parent:g.id}),l=0,h=g.parents.length;l<h;l++)this._model.data[g.parents[l]].children_d=this._model.data[g.parents[l]].children_d.concat(d);for(d=[],l=0,h=g.children.length;l<h;l++)d[i<=l?l+1:l]=g.children[l];return d[i]=c.id,g.children=d,g.children_d.push(c.id),g.children_d=g.children_d.concat(c.children_d),"#"===g.id&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(g.id),n||this.redraw("#"===g.id),r&&r.call(this,c,g,i),this.trigger("copy_node",{node:c,original:e,parent:g.id,position:i,old_parent:u,old_position:f&&f._id&&u&&f._model.data[u]&&f._model.data[u].children?O.inArray(e.id,f._model.data[u].children):-1,is_multi:f&&f._id&&f._id!==this._id,is_foreign:!f||!f._id,old_instance:f,new_instance:this}),c.id},cut:function(e){if(e||(e=this._data.core.selected.concat()),O.isArray(e)||(e=[e]),!e.length)return!1;var t,i,r,s=[];for(i=0,r=e.length;i<r;i++)(t=this.get_node(e[i]))&&t.id&&"#"!==t.id&&s.push(t);return!!s.length&&(n=s,a="move_node",void(o=this).trigger("cut",{node:e}))},copy:function(e){if(e||(e=this._data.core.selected.concat()),O.isArray(e)||(e=[e]),!e.length)return!1;var t,i,r,s=[];for(i=0,r=e.length;i<r;i++)(t=this.get_node(e[i]))&&t.id&&"#"!==t.id&&s.push(t);return!!s.length&&(n=s,a="copy_node",void(o=this).trigger("copy",{node:e}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),void(o=a=n=!1))},clear_buffer:function(){o=a=n=!1,this.trigger("clear_buffer")},edit:function(t,e){if(!(t=this.get_node(t)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;e="string"==typeof e?e:t.text,this.set_text(t,""),t=this._open_to(t);var i=this._data.core.rtl,r=this.element.width(),s=t.children(".jstree-anchor"),n=O("<span>"),a=e,o=O("<div />",{css:{position:"absolute",top:"-200px",left:i?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=O("<input />",{value:a,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:O.proxy(function(){var e=n.children(".jstree-rename-input").val();""===e&&(e=a),o.remove(),n.replaceWith(s),n.remove(),this.set_text(t,a),!1===this.rename_node(t,O("<div></div>").text(e)[this.settings.core.force_text?"text":"html"]())&&this.set_text(t,a)},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(){d.width(Math.min(o.text("pW"+this.value).width(),r))},keypress:function(e){return 13!==e.which&&void 0}}),c={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""};n.attr("class",s.attr("class")).append(s.contents().clone()).append(d),s.replaceWith(n),o.css(c),d.css(c).width(Math.min(o.text("pW"+d[0].value).width(),r))[0].select()},set_theme:function(e,t){if(!e)return!1;if(!0===t){var i=this.settings.core.themes.dir;i||(i=O.jstree.path+"/themes"),t=i+"/"+e+"/style.css"}t&&-1===O.inArray(t,r)&&(O("head").append('<link rel="stylesheet" href="'+t+'" type="text/css" />'),r.push(t)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=e,this.element.addClass("jstree-"+e),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive"),this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),(this._data.core.themes.variant=e)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(e,t){var i,r,s,n;if(O.isArray(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.set_icon(e[i],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(n=e.icon,e.icon=t,s=this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===t?this.hide_icon(e):(!0===t?s.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"):-1===t.indexOf("/")&&-1===t.indexOf(".")?(s.removeClass(n).css("background",""),s.addClass(t+" jstree-themeicon-custom").attr("rel",t)):(s.removeClass(n).css("background",""),s.addClass("jstree-themeicon-custom").css("background","url('"+t+"') center center no-repeat").attr("rel",t)),!1===n&&this.show_icon(e)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(e){var t,i;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.hide_icon(e[t]);return!0}return!(!(e=this.get_node(e))||"#"===e)&&(e.icon=!1,this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(e){var t,i,r;if(O.isArray(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.show_icon(e[t]);return!0}return!(!(e=this.get_node(e))||"#"===e)&&(r=this.get_node(e,!0),e.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),e.icon||(e.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},O.vakata={},O.vakata.attributes=function(e,i){e=O(e)[0];var r=i?{}:[];return e&&e.attributes&&O.each(e.attributes,function(e,t){-1===O.inArray(t.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==t.value&&""!==O.trim(t.value)&&(i?r[t.name]=t.value:r.push(t.name))}),r},O.vakata.array_unique=function(e){var t,i,r,s=[];for(t=0,r=e.length;t<r;t++){for(i=0;i<=t&&e[t]!==e[i];i++);i===t&&s.push(e[t])}return s},O.vakata.array_remove=function(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r),e},O.vakata.array_remove_item=function(e,t){var i=O.inArray(t,e);return-1!==i?O.vakata.array_remove(e,i):e};var c=document.createElement("I");c.className="jstree-icon jstree-checkbox",c.setAttribute("role","presentation"),O.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},O.jstree.plugins.checkbox=function(e,a){this.bind=function(){a.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",O.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",O.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",O.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(O.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",O.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;i<r;i++)s[n[i]].state.checked=s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",O.proxy(function(e,t){var i,r,s,n,a,o,d=this._model.data,c=d[t.parent],l=t.nodes,h=[],_=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==_.indexOf("down"))if(c.state[u?"selected":"checked"]){for(r=0,s=l.length;r<s;r++)d[l[r]].state[u?"selected":"checked"]=!0
;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(l)}else for(r=0,s=l.length;r<s;r++)if(d[l[r]].state[u?"selected":"checked"]){for(n=0,a=d[l[r]].children_d.length;n<a;n++)d[d[l[r]].children_d[n]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(d[l[r]].children_d)}if(-1!==_.indexOf("up")){for(r=0,s=c.children_d.length;r<s;r++)d[c.children_d[r]].children.length||h.push(d[c.children_d[r]].parent);for(n=0,a=(h=O.vakata.array_unique(h)).length;n<a;n++)for(c=d[h[n]];c&&"#"!==c.id;){for(r=i=0,s=c.children.length;r<s;r++)i+=d[c.children[r]].state[u?"selected":"checked"];if(i!==s)break;c.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(c.id),(o=this.get_node(c,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[u?"core":"checkbox"].selected=O.vakata.array_unique(this._data[u?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",O.proxy(function(e,t){var i,r,s,n,a=t.node,o=this._model.data,d=this.get_node(a.parent),c=this.get_node(a,!0),l=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))for(this._data[h?"core":"checkbox"].selected=O.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(a.children_d)),i=0,r=a.children_d.length;i<r;i++)(n=o[a.children_d[i]]).state[h?"selected":"checked"]=!0,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(;d&&"#"!==d.id;){for(i=s=0,r=d.children.length;i<r;i++)s+=o[d.children[i]].state[h?"selected":"checked"];if(s!==r)break;d.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(d.id),(n=this.get_node(d,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}-1!==l.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",O.proxy(function(){var e,t,i,r=this.get_node("#"),s=this._model.data;for(e=0,t=r.children_d.length;e<t;e++)(i=s[r.children_d[e]])&&i.original&&i.original.state&&i.original.state.undetermined&&(i.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",O.proxy(function(e,t){var i,r,s,n=t.node,a=this.get_node(n,!0),o=this.settings.checkbox.cascade,d=this.settings.checkbox.tie_selection;if(n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),-1!==o.indexOf("down"))for(i=0,r=n.children_d.length;i<r;i++)(s=this._model.data[n.children_d[i]]).state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1);if(-1!==o.indexOf("up"))for(i=0,r=n.parents.length;i<r;i++)(s=this._model.data[n.parents[i]]).state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),(s=this.get_node(n.parents[i],!0))&&s.length&&s.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked");for(s=[],i=0,r=this._data[d?"core":"checkbox"].selected.length;i<r;i++)-1!==o.indexOf("down")&&-1!==O.inArray(this._data[d?"core":"checkbox"].selected[i],n.children_d)||-1!==o.indexOf("up")&&-1!==O.inArray(this._data[d?"core":"checkbox"].selected[i],n.parents)||s.push(this._data[d?"core":"checkbox"].selected[i]);this._data[d?"core":"checkbox"].selected=O.vakata.array_unique(s),-1!==o.indexOf("down")&&a.length&&a.find(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",O.proxy(function(e,t){for(var i,r,s,n,a=this.get_node(t.parent),o=this._model.data,d=this.settings.checkbox.tie_selection;a&&"#"!==a.id;){for(i=s=0,r=a.children.length;i<r;i++)s+=o[a.children[i]].state[d?"selected":"checked"];if(s!==r)break;a.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(a.id),(n=this.get_node(a,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked"),a=this.get_node(a.parent)}},this)).on("move_node.jstree",O.proxy(function(e,t){var i,r,s,n,a,o=t.is_multi,d=t.old_parent,c=this.get_node(t.parent),l=this._model.data,h=this.settings.checkbox.tie_selection;if(!o)for(i=this.get_node(d);i&&"#"!==i.id;){for(s=r=0,n=i.children.length;s<n;s++)r+=l[i.children[s]].state[h?"selected":"checked"];if(r!==n)break;i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=c;i&&"#"!==i.id;){for(s=r=0,n=i.children.length;s<n;s++)r+=l[i.children[s]].state[h?"selected":"checked"];if(r===n)i.state[h?"selected":"checked"]||(i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"));else{if(!i.state[h?"selected":"checked"])break;i.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=O.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){var i,r,s=this._model.data,e=this.settings.checkbox.tie_selection,t=this._data[e?"core":"checkbox"].selected,n=[],a=this;for(i=0,r=t.length;i<r;i++)s[t[i]]&&s[t[i]].parents&&(n=n.concat(s[t[i]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,t=a.get_node(this);if(t.state.loaded)for(i=0,r=t.children_d.length;i<r;i++)!(e=s[t.children_d[i]]).state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(n.push(e.id),n=n.concat(e.parents));else t.original&&t.original.state&&t.original.state.undetermined&&!0===t.original.state.undetermined&&(n.push(t.id),n=n.concat(t.parents))}),n=O.vakata.array_unique(n),n=O.vakata.array_remove_item(n,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=n.length;i<r;i++)s[n[i]].state[e?"selected":"checked"]||(t=this.get_node(n[i],!0))&&t.length&&t.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(e,t,i){if(e=a.redraw_node.apply(this,arguments)){var r,s,n=null;for(r=0,s=e.childNodes.length;r<s;r++)if(e.childNodes[r]&&e.childNodes[r].className&&-1!==e.childNodes[r].className.indexOf("jstree-anchor")){n=e.childNodes[r];break}n&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(n.className+=" jstree-checked"),n.insertBefore(c.cloneNode(!1),n.childNodes[0]))}return i||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(O.proxy(this._undetermined,this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(e){e=this.get_node(e);var t,i,r=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,n=this._data[s?"core":"checkbox"].selected,a=this._model.data;if(!e||!0===e.state[s?"selected":"checked"]||-1===r.indexOf("undetermined")||-1===r.indexOf("down")&&-1===r.indexOf("up"))return!1;if(!e.state.loaded&&!0===e.original.state.undetermined)return!0;for(t=0,i=e.children_d.length;t<i;t++)if(-1!==O.inArray(e.children_d[t],n)||!a[e.children_d[t]].state.loaded&&a[e.children_d[t]].original.state.undetermined)return!0;return!1},this.activate_node=function(e,t){return this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||O(t.target).hasClass("jstree-checkbox"))&&(t.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!O(t.target).hasClass("jstree-checkbox")?a.activate_node.call(this,e,t):!this.is_disabled(e)&&(this.is_checked(e)?this.uncheck_node(e,t):this.check_node(e,t),void this.trigger("activate_node",{node:this.get_node(e)}))},this.check_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.select_node(e,!1,!0,t);var i,r,s;if(O.isArray(e)){for(r=0,s=(e=e.slice()).length;r<s;r++)this.check_node(e[r],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(i=this.get_node(e,!0),void(e.state.checked||(e.state.checked=!0,this._data.checkbox.selected.push(e.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:e,selected:this._data.checkbox.selected,event:t}))))},this.uncheck_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.deselect_node(e,!1,t);var i,r,s;if(O.isArray(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.uncheck_node(e[i],t);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(s=this.get_node(e,!0),void(e.state.checked&&(e.state.checked=!1,this._data.checkbox.selected=O.vakata.array_remove_item(this._data.checkbox.selected,e.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:e,selected:this._data.checkbox.selected,event:t}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(e){return this.settings.checkbox.tie_selection?this.get_selected(e):e?O.map(this._data.checkbox.selected,O.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_top_selected(e);var t,i,r,s,n=this.get_checked(!0),a={};for(t=0,i=n.length;t<i;t++)a[n[t].id]=n[t];for(t=0,i=n.length;t<i;t++)for(r=0,s=n[t].children_d.length;r<s;r++)a[n[t].children_d[r]]&&delete a[n[t].children_d[r]];for(t in n=[],a)a.hasOwnProperty(t)&&n.push(t);return e?O.map(n,O.proxy(function(e){return this.get_node(e)},this)):n},this.get_bottom_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(e);var t,i,r=this.get_checked(!0),s=[];for(t=0,i=r.length;t<i;t++)r[t].children.length||s.push(r[t].id);return e?O.map(s,O.proxy(function(e){return this.get_node(e)},this)):s},this.load_node=function(e){var t,i,r;if(!O.isArray(e)&&!this.settings.checkbox.tie_selection&&((r=this.get_node(e))&&r.state.loaded))for(t=0,i=r.children_d.length;t<i;t++)this._model.data[r.children_d[t]].state.checked&&(!0,this._data.checkbox.selected=O.vakata.array_remove_item(this._data.checkbox.selected,r.children_d[t]));return a.load_node.apply(this,arguments)},this.get_state=function(){var e=a.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(e){var t=a.set_state.apply(this,arguments);if(t&&e.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var i=this;O.each(e.checkbox,function(e,t){i.check_node(t)})}return delete e.checkbox,!1}return t}};var l,h,_=null;O.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.create_node(i,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.delete_node(t.is_selected(i)?t.get_selected():i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.cut(t.is_selected(i)?t.get_selected():i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.copy(t.is_selected(i)?t.get_selected():i)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!O.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=O.jstree.reference(e.reference),i=t.get_node(e.reference);t.paste(i)}}}}}}},O.jstree.plugins.contextmenu=function(e,t){this.bind=function(){t.bind.call(this);var i=0;this.element.on("contextmenu.jstree",".jstree-anchor",O.proxy(function(e,t){e.preventDefault(),i=e.ctrlKey?+new Date:0,(t||_)&&(i=+new Date+1e4),_&&clearTimeout(_),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",O.proxy(function(){this._data.contextmenu.visible&&(!i||250<+new Date-i)&&O.vakata.context.hide(),i=0},this)).on("touchstart.jstree",".jstree-anchor",function(e){e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(l=e.pageX,h=e.pageY,_=setTimeout(function(){O(e.currentTarget).trigger("contextmenu",!0)},750))}),O(document).on("context_hide.vakata.jstree",O.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&O.vakata.context.hide(),t.teardown.call(this)},this.show_contextmenu=function(t,i,r,e){if(!(t=this.get_node(t))||"#"===t.id)return!1;var s=this.settings.contextmenu,n=this.get_node(t,!0).children(".jstree-anchor"),a=!1,o=!1;(s.show_at_node||i===k||r===k)&&(a=n.offset(),i=a.left,r=a.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,e),o=s.items,O.isFunction(o)&&(o=o.call(this,t,O.proxy(function(e){this._show_contextmenu(t,i,r,e)},this))),O.isPlainObject(o)&&this._show_contextmenu(t,i,r,o)},this._show_contextmenu=function(e,t,i,r){var s=this.get_node(e,!0).children(".jstree-anchor");O(document).one("context_show.vakata.jstree",O.proxy(function(e,t){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";O(t.element).addClass(i)},this)),this._data.contextmenu.visible=!0,O.vakata.context.show(s,{x:t,y:i},r),this.trigger("show_contextmenu",{node:e,x:t,y:i})}},O(function(){O(document).on("touchmove.vakata.jstree",function(e){_&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(50<Math.abs(l-e.pageX)||50<Math.abs(h-e.pageY))&&clearTimeout(_)}).on("touchend.vakata.jstree",function(){_&&clearTimeout(_)})}),y={element:j=!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1},(m=O).vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){m(document).triggerHandler("context_"+e+".vakata",{reference:y.reference,element:y.element,position:{x:y.position_x,y:y.position_y}})},_execute:function(e){return!(!(e=y.items[e])||e._disabled&&(!m.isFunction(e._disabled)||e._disabled({item:e,reference:y.reference,element:y.element}))||!e.action)&&e.action.call(null,{item:e,reference:y.reference,element:y.element,position:{x:y.position_x,y:y.position_y}})},_parse:function(e,t){if(!e)return!1;t||(y.html="",y.items=[]);var i,r="",s=!1;return t&&(r+="<ul>"),m.each(e,function(e,t){return!t||(y.items.push(t),!s&&t.separator_before&&(r+="<li class='vakata-context-separator'><a href='#' "+(m.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),s=!1,r+="<li class='"+(t._class||"")+(!0===t._disabled||m.isFunction(t._disabled)&&t._disabled({item:t,reference:y.reference,element:y.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">",r+="<a href='#' rel='"+(y.items.length-1)+"'>",m.vakata.context.settings.icons&&(r+="<i ",t.icon&&(r+=-1!==t.icon.indexOf("/")||-1!==t.icon.indexOf(".")?" style='background:url(\""+t.icon+"\") center center no-repeat' ":" class='"+t.icon+"' "),r+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),r+=(m.isFunction(t.label)?t.label({item:e,reference:y.reference,element:y.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"</a>",t.submenu&&(i=m.vakata.context._parse(t.submenu,!0))&&(r+=i),r+="</li>",void(t.separator_after&&(r+="<li class='vakata-context-separator'><a href='#' "+(m.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",s=!0)))}),r=r.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),t&&(r+="</ul>"),t||(y.html=r,m.vakata.context._trigger("parse")),10<r.length&&r},_show_submenu:function(e){if((e=m(e)).length&&e.children("ul").length){var t=e.children("ul"),i=e.offset().left+e.outerWidth(),r=e.offset().top,s=t.width(),n=t.height(),a=m(window).width()+m(window).scrollLeft(),o=m(window).height()+m(window).scrollTop();j?e[i-(s+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):e[a<i+s+10?"addClass":"removeClass"]("vakata-context-right"),o<r+n+10&&t.css("bottom","-1px"),t.show()}},show:function(e,t,i){var r,s,n,a,o,d,c,l,h=!0;switch(y.element&&y.element.length&&y.element.width(""),h){case!t&&!e:return!1;case!!t&&!!e:y.reference=e,y.position_x=t.x,y.position_y=t.y;break;case!t&&!!e:r=(y.reference=e).offset(),y.position_x=r.left+e.outerHeight(),y.position_y=r.top;break;case!!t&&!e:y.position_x=t.x,y.position_y=t.y}e&&!i&&m(e).data("vakata_contextmenu")&&(i=m(e).data("vakata_contextmenu")),m.vakata.context._parse(i)&&y.element.html(y.html),y.items.length&&(y.element.appendTo("body"),s=y.element,n=y.position_x,a=y.position_y,o=s.width(),d=s.height(),c=m(window).width()+m(window).scrollLeft(),l=m(window).height()+m(window).scrollTop(),j&&(n-=s.outerWidth()-m(e).outerWidth())<m(window).scrollLeft()+20&&(n=m(window).scrollLeft()+20),c<n+o+20&&(n=c-(o+20)),l<a+d+20&&(a=l-(d+20)),y.element.css({left:n,top:a}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),y.is_visible=!0,m.vakata.context._trigger("show"))},hide:function(){y.is_visible&&(y.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),y.is_visible=!1,m.vakata.context._trigger("hide"))}},m(function(){j="rtl"===m("body").css("direction");var t=!1;y.element=m("<ul class='vakata-context'></ul>"),y.element.on("mouseenter","li",function(e){e.stopImmediatePropagation(),m.contains(this,e.relatedTarget)||(t&&clearTimeout(t),y.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),m(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),m.vakata.context._show_submenu(this))}).on("mouseleave","li",function(e){m.contains(this,e.relatedTarget)||m(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){m(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),m.vakata.context.settings.hide_onmouseleave&&(t=setTimeout(function(){m.vakata.context.hide()},m.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(e){e.preventDefault(),m(this).blur().parent().hasClass("vakata-context-disabled")||!1===m.vakata.context._execute(m(this).attr("rel"))||m.vakata.context.hide()}).on("keydown","a",function(e){var t=null;switch(e.which){case 13:case 32:e.type="mouseup",e.preventDefault(),m(e.currentTarget).trigger(e);break;case 37:y.is_visible&&(y.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 38:y.is_visible&&((t=y.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length||(t=y.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),t.addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 39:y.is_visible&&(y.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 40:y.is_visible&&((t=y.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length||(t=y.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),t.addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 27:m.vakata.context.hide(),e.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=y.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),m(document).on("mousedown.vakata.jstree",function(e){y.is_visible&&!m.contains(y.element[0],e.target)&&m.vakata.context.hide()}).on("context_show.vakata.jstree",function(){y.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),j&&y.element.addClass("vakata-context-rtl").css("direction","rtl"),y.element.find("ul").hide().end()})}),O.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0},O.jstree.plugins.dnd=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",O.proxy(function(e){if("touchstart"===e.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!O(e.currentTarget).hasClass("jstree-clicked")))return!0;var t=this.get_node(e.target),i=this.is_selected(t)&&this.settings.drag_selection?this.get_selected().length:1,r=1<i?i+" "+this.get_string("nodes"):this.get_text(e.currentTarget);return this.settings.core.force_text&&(r=O("<div />").text(r).html()),t&&t.id&&"#"!==t.id&&(1===e.which||"touchstart"===e.type)&&(!0===this.settings.dnd.is_draggable||O.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<i?this.get_selected(!0):[t]))?(this.element.trigger("mousedown.jstree"),O.vakata.dnd.start(e,{jstree:!0,origin:this,obj:this.get_node(t,!0),nodes:1<i?this.get_selected():[t.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+r+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},O(function(){var x=!1,b=!1,w=!1,C=O('<div id="jstree-marker">&#160;</div>').hide();O(document).on("dnd_start.vakata.jstree",function(e,t){x=!1,t&&t.data&&t.data.jstree&&C.appendTo("body")}).on("dnd_move.vakata.jstree",function(e,s){if(w&&clearTimeout(w),s&&s.data&&s.data.jstree&&(!s.event.target.id||"jstree-marker"!==s.event.target.id)){var n,a,o,d,c,l,h,_,u,g,f,p,m,v,j=O.jstree.reference(s.event.target),k=!1,y=!1,t=!1;if(j&&j._data&&j._data.dnd)if(C.attr("class","jstree-"+j.get_theme()+(j.settings.core.themes.responsive?" jstree-dnd-responsive":"")),s.helper.children().attr("class","jstree-"+j.get_theme()+" jstree-"+j.get_theme()+"-"+j.get_theme_variant()+" "+(j.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey))?"show":"hide"](),s.event.target!==j.element[0]&&s.event.target!==j.get_container_ul()[0]||0!==j.get_container_ul().children().length){if((k=O(s.event.target).closest(".jstree-anchor"))&&k.length&&k.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(y=k.offset(),t=s.event.pageY-y.top,o=k.height(),l=t<o/3?["b","i","a"]:o-o/3<t?["a","i","b"]:o/2<t?["i","a","b"]:["i","b","a"],O.each(l,function(e,t){switch(t){case"b":n=y.left-6,a=y.top,d=j.get_parent(k),c=k.parent().index();break;case"i":m=j.settings.dnd.inside_pos,v=j.get_node(k.parent()),n=y.left-2,a=y.top+o/2+1,d=v.id,c="first"===m?0:"last"===m?v.children.length:Math.min(m,v.children.length);break;case"a":n=y.left-6,a=y.top+o,d=j.get_parent(k),c=k.parent().index()+1}for(h=!0,_=0,u=s.data.nodes.length;_<u;_++)if(g=s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey))?"copy_node":"move_node",f=c,"move_node"===g&&"a"===t&&s.data.origin&&s.data.origin===j&&d===j.get_parent(s.data.nodes[_])&&(p=j.get_node(d),f>O.inArray(s.data.nodes[_],p.children)&&(f-=1)),!(h=h&&(j&&j.settings&&j.settings.dnd&&!1===j.settings.dnd.check_while_dragging||j.check(g,s.data.origin&&s.data.origin!==j?s.data.origin.get_node(s.data.nodes[_]):s.data.nodes[_],d,f,{dnd:!0,ref:j.get_node(k.parent()),pos:t,is_multi:s.data.origin&&s.data.origin!==j,is_foreign:!s.data.origin})))){j&&j.last_error&&(b=j.last_error());break}return"i"===t&&k.parent().is(".jstree-closed")&&j.settings.dnd.open_timeout&&(w=setTimeout((i=j,r=k,function(){i.open_node(r)}),j.settings.dnd.open_timeout)),h?(x={ins:j,par:d,pos:"i"!==t||"last"!==m||0!==c||j.is_loaded(v)?c:"last"},C.css({left:n+"px",top:a+"px"}).show(),s.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),b={},l=!0,!1):void 0;var i,r}),!0===l))return}else{for(h=!0,_=0,u=s.data.nodes.length;_<u&&(h=h&&j.check(s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey))?"copy_node":"move_node",s.data.origin&&s.data.origin!==j?s.data.origin.get_node(s.data.nodes[_]):s.data.nodes[_],"#","last",{dnd:!0,ref:j.get_node("#"),pos:"i",is_multi:s.data.origin&&s.data.origin!==j,is_foreign:!s.data.origin}));_++);if(h)return x={ins:j,par:"#",pos:"last"},C.hide(),void s.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}x=!1,s.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),C.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(C.hide(),x=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(e,t){if(w&&clearTimeout(w),t&&t.data&&t.data.jstree){C.hide().detach();var i,r,s=[];if(x){for(i=0,r=t.data.nodes.length;i<r;i++)s[i]=t.data.origin?t.data.origin.get_node(t.data.nodes[i]):t.data.nodes[i],t.data.origin&&(s[i].instance=t.data.origin);for(x.ins[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(t.event.metaKey||t.event.ctrlKey))?"copy_node":"move_node"](s,x.par,x.pos),i=0,r=s.length;i<r;i++)s[i].instance&&(s[i].instance=null)}else(i=O(t.event.target).closest(".jstree")).length&&b&&b.error&&"check"===b.error&&((i=i.jstree(!0))&&i.settings.core.error.call(this,b))}}).on("keyup.jstree keydown.jstree",function(e,t){(t=O.vakata.dnd._get())&&t.data&&t.data.jstree&&t.helper.find(".jstree-copy").first()[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"]()})}),p={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},(f=O).vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(e,t){var i=f.vakata.dnd._get();i.event=t,f(document).triggerHandler("dnd_"+e+".vakata",i)},_get:function(){return{data:p.data,element:p.element,helper:p.helper}},_clean:function(){p.helper&&p.helper.remove(),p.scroll_i&&(clearInterval(p.scroll_i),p.scroll_i=!1),p={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},f(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(document).off("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop)},_scroll:function(e){if(!p.scroll_e||!p.scroll_l&&!p.scroll_t)return p.scroll_i&&(clearInterval(p.scroll_i),p.scroll_i=!1),!1;if(!p.scroll_i)return p.scroll_i=setInterval(f.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var t=p.scroll_e.scrollTop(),i=p.scroll_e.scrollLeft();p.scroll_e.scrollTop(t+p.scroll_t*f.vakata.dnd.settings.scroll_speed),p.scroll_e.scrollLeft(i+p.scroll_l*f.vakata.dnd.settings.scroll_speed),(t!==p.scroll_e.scrollTop()||i!==p.scroll_e.scrollLeft())&&f.vakata.dnd._trigger("scroll",p.scroll_e)},start:function(e,t,i){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),p.is_drag&&f.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.MozUserSelect="none")}catch(o){}return p.init_x=e.pageX,p.init_y=e.pageY,p.data=t,p.is_down=!0,p.element=e.currentTarget,p.target=e.target,p.is_touch="touchstart"===e.type,!1!==i&&(p.helper=f("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),f(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(document).on("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),p.is_down){if(!p.is_drag){if(!(Math.abs(i.pageX-p.init_x)>(p.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)||Math.abs(i.pageY-p.init_y)>(p.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)))return;p.helper&&(p.helper.appendTo("body"),p.helper_w=p.helper.outerWidth()),p.is_drag=!0,f.vakata.dnd._trigger("start",i)}var e=!1,t=!1,r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,c=!1,l=!1;return p.scroll_t=0,p.scroll_l=0,p.scroll_e=!1,f(f(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(f(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=f(this),t=e.offset();return this.scrollHeight>this.offsetHeight&&(t.top+e.height()-i.pageY<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_t=1),
i.pageY-t.top<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(t.left+e.width()-i.pageX<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_l=1),i.pageX-t.left<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_l=-1)),p.scroll_t||p.scroll_l?(p.scroll_e=f(this),!1):void 0}),p.scroll_e||(e=f(document),t=f(window),r=e.height(),s=t.height(),n=e.width(),a=t.width(),o=e.scrollTop(),d=e.scrollLeft(),s<r&&i.pageY-o<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_t=-1),s<r&&s-(i.pageY-o)<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_t=1),a<n&&i.pageX-d<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_l=-1),a<n&&a-(i.pageX-d)<f.vakata.dnd.settings.scroll_proximity&&(p.scroll_l=1),(p.scroll_t||p.scroll_l)&&(p.scroll_e=e)),p.scroll_e&&f.vakata.dnd._scroll(!0),p.helper&&(c=parseInt(i.pageY+f.vakata.dnd.settings.helper_top,10),l=parseInt(i.pageX+f.vakata.dnd.settings.helper_left,10),r&&r<c+25&&(c=r-50),n&&l+p.helper_w>n&&(l=n-(p.helper_w+2)),p.helper.css({left:l+"px",top:c+"px"})),f.vakata.dnd._trigger("move",i),!1}},stop:function(e){if("touchend"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),p.is_drag)f.vakata.dnd._trigger("stop",e);else if("touchend"===e.type&&e.target===p.target){var t=setTimeout(function(){f(e.target).click()},100);f(e.target).one("click",function(){t&&clearTimeout(t)})}return f.vakata.dnd._clean(),!1}},O.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},O.jstree.plugins.search=function(e,t){this.bind=function(){t.bind.call(this),this._data.search.str="",this._data.search.dom=O(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this.element.on("before_open.jstree",O.proxy(function(){var e,t,i=this._data.search.res,r=[],s=O();if(i&&i.length&&(this._data.search.dom=O(this.element[0].querySelectorAll("#"+O.map(i,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(O.jstree.idregex,"\\$&"):e.replace(O.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){for(e=0,t=i.length;e<t;e++)r=r.concat(this.get_node(i[e]).parents);s=(r=O.vakata.array_remove_item(O.vakata.array_unique(r),"#")).length?O(this.element[0].querySelectorAll("#"+O.map(r,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(O.jstree.idregex,"\\$&"):e.replace(O.jstree.idregex,"\\$&")}).join(", #"))):O(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),(s=s.add(this._data.search.dom)).parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){O(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",O.proxy(function(e,t){this._data.search.som&&t.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),t.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){O(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",O.proxy(function(e,t){this._data.search.som&&t.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))},this.search=function(i,e,t){if(!1===i||""===O.trim(i.toString()))return this.clear_search();i=i.toString();var r=this.settings.search,s=!!r.ajax&&r.ajax,n=null,a=[],o=[];return this._data.search.res.length&&this.clear_search(),t===k&&(t=r.show_only_matches),e||!1===s?(this._data.search.str=i,this._data.search.dom=O(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=t,n=new O.vakata.search(i,!0,{caseSensitive:r.case_sensitive,fuzzy:r.fuzzy}),O.each(this._model.data,function(e,t){t.text&&(r.search_callback&&r.search_callback.call(this,i,t)||!r.search_callback&&n.search(t.text).isMatch)&&(!r.search_leaves_only||t.state.loaded&&0===t.children.length)&&(a.push(e),o=o.concat(t.parents))}),a.length&&(o=O.vakata.array_unique(o),this._search_open(o),this._data.search.dom=O(this.element[0].querySelectorAll("#"+O.map(a,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(O.jstree.idregex,"\\$&"):e.replace(O.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=a,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),void this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:t})):O.isFunction(s)?s.call(this,i,O.proxy(function(e){e&&e.d&&(e=e.d),this._load_nodes(O.isArray(e)?O.vakata.array_unique(e):[],function(){this.search(i,!0,t)},!0)},this)):((s=O.extend({},s)).data||(s.data={}),s.data.str=i,O.ajax(s).fail(O.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(s)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(O.proxy(function(e){e&&e.d&&(e=e.d),this._load_nodes(O.isArray(e)?O.vakata.array_unique(e):[],function(){this.search(i,!0,t)},!0)},this)))},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=O()},this._search_open=function(i){var r=this;O.each(i.concat([]),function(e,t){if("#"===t)return!0;try{t=O("#"+t.replace(O.jstree.idregex,"\\$&"),r.element)}catch(o){}t&&t.length&&r.is_closed(t)&&(r._data.search.opn.push(t[0].id),r.open_node(t,function(){r._search_open(i)},0))})}},O.vakata.search=function(p,e,m){!1!==(m=m||{}).fuzzy&&(m.fuzzy=!0),p=m.caseSensitive?p:p.toLowerCase();var v,j,k,t,y=m.location||0,s=m.distance||100,x=m.threshold||.6,b=p.length;return 32<b&&(m.fuzzy=!1),m.fuzzy&&(v=1<<b-1,j=function(){var e={},t=0;for(t=0;t<b;t++)e[p.charAt(t)]=0;for(t=0;t<b;t++)e[p.charAt(t)]|=1<<b-t-1;return e}(),k=function(e,t){var i=e/b,r=Math.abs(y-t);return s?i+r/s:r?1:i}),t=function(e){if(e=m.caseSensitive?e:e.toLowerCase(),p===e||-1!==e.indexOf(p))return{isMatch:!0,score:0};if(!m.fuzzy)return{isMatch:!1,score:1};var t,i,r,s,n,a,o,d,c,l=e.length,h=x,_=e.indexOf(p,y),u=b+l,g=1,f=[];for(-1!==_&&(h=Math.min(k(0,_),h),-1!==(_=e.lastIndexOf(p,y+b))&&(h=Math.min(k(0,_),h))),_=-1,t=0;t<b;t++){for(r=0,s=u;r<s;)k(t,y+s)<=h?r=s:u=s,s=Math.floor((u-r)/2+r);for(u=s,a=Math.max(1,y-s+1),o=Math.min(y+s,l)+b,(d=new Array(o+2))[o+1]=(1<<t)-1,i=o;a<=i;i--)if(c=j[e.charAt(i-1)],d[i]=0===t?(d[i+1]<<1|1)&c:(d[i+1]<<1|1)&c|(n[i+1]|n[i])<<1|1|n[i+1],d[i]&v&&(g=k(t,i-1))<=h){if(h=g,_=i-1,f.push(_),!(y<_))break;a=Math.max(1,2*y-_)}if(k(t+1,y)>h)break;n=d}return{isMatch:0<=_,score:g}},!0===e?{search:t}:t(e)},O.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},O.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("model.jstree",O.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",O.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",O.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(e,t){var i,r;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(O.proxy(this.settings.sort,this)),t))for(i=0,r=e.children_d.length;i<r;i++)this.sort(e.children_d[i],!1)}};var u=!1;O.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},O.jstree.plugins.state=function(e,t){this.bind=function(){t.bind.call(this);var e=O.proxy(function(){this.element.on(this.settings.state.events,O.proxy(function(){u&&clearTimeout(u),u=setTimeout(O.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",O.proxy(function(){this.element.one("restore_state.jstree",e),this.restore_state()||e()},this))},this.save_state=function(){var e={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};O.vakata.storage.set(this.settings.state.key,JSON.stringify(e))},this.restore_state=function(){var i=O.vakata.storage.get(this.settings.state.key);if(i)try{i=JSON.parse(i)}catch(t){return!1}return!(i&&i.ttl&&i.sec&&+new Date-i.sec>i.ttl)&&(i&&i.state&&(i=i.state),i&&O.isFunction(this.settings.state.filter)&&(i=this.settings.state.filter.call(this,i)),!!i&&(this.element.one("set_state.jstree",function(e,t){t.instance.trigger("restore_state",{state:O.extend(!0,{},i)})}),this.set_state(i),!0))},this.clear_state=function(){return O.vakata.storage.del(this.settings.state.key)}},O.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}},O.jstree.defaults.types={"#":{},"default":{}},O.jstree.plugins.types=function(e,l){this.init=function(e,t){var i,r;if(t&&t.types&&t.types["default"])for(i in t.types)if("default"!==i&&"#"!==i&&t.types.hasOwnProperty(i))for(r in t.types["default"])t.types["default"].hasOwnProperty(r)&&t.types[i][r]===k&&(t.types[i][r]=t.types["default"][r]);l.init.call(this,e,t),this._model.data["#"].type="#"},this.refresh=function(e,t){l.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",O.proxy(function(e,t){var i,r,s=this._model.data,n=t.nodes,a=this.settings.types,o="default";for(i=0,r=n.length;i<r;i++)o="default",s[n[i]].original&&s[n[i]].original.type&&a[s[n[i]].original.type]&&(o=s[n[i]].original.type),s[n[i]].data&&s[n[i]].data.jstree&&s[n[i]].data.jstree.type&&a[s[n[i]].data.jstree.type]&&(o=s[n[i]].data.jstree.type),s[n[i]].type=o,!0===s[n[i]].icon&&a[o].icon!==k&&(s[n[i]].icon=a[o].icon);s["#"].type="#"},this)),l.bind.call(this)},this.get_json=function(e,t,i){var r,s,n=this._model.data,a=t?O.extend(!0,{},t,{no_id:!1}):{},o=l.get_json.call(this,e,a,i);if(!1===o)return!1;if(O.isArray(o))for(r=0,s=o.length;r<s;r++)o[r].type=o[r].id&&n[o[r].id]&&n[o[r].id].type?n[o[r].id].type:"default",t&&t.no_id&&(delete o[r].id,o[r].li_attr&&o[r].li_attr.id&&delete o[r].li_attr.id,o[r].a_attr&&o[r].a_attr.id&&delete o[r].a_attr.id);else o.type=o.id&&n[o.id]&&n[o.id].type?n[o.id].type:"default",t&&t.no_id&&(o=this._delete_ids(o));return o},this._delete_ids=function(e){if(O.isArray(e)){for(var t=0,i=e.length;t<i;t++)e[t]=this._delete_ids(e[t]);return e}return delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id,e.children&&O.isArray(e.children)&&(e.children=this._delete_ids(e.children)),e},this.check=function(e,t,i,r,s){if(!1===l.check.call(this,e,t,i,r,s))return!1;t=t&&t.id?t:this.get_node(t),i=i&&i.id?i:this.get_node(i);var n,a,o,d,c=t&&t.id?O.jstree.reference(t.id):null;switch(c=c&&c._model&&c._model.data?c._model.data:null,e){case"create_node":case"move_node":case"copy_node":if("move_node"!==e||-1===O.inArray(t.id,i.children)){if((n=this.get_rules(i)).max_children!==k&&-1!==n.max_children&&n.max_children===i.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1;if(n.valid_children!==k&&-1!==n.valid_children&&-1===O.inArray(t.type||"default",n.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1;if(c&&t.children_d&&t.parents){for(o=a=0,d=t.children_d.length;o<d;o++)a=Math.max(a,c[t.children_d[o]].parents.length);a=a-t.parents.length+1}(a<=0||a===k)&&(a=1);do{if(n.max_depth!==k&&-1!==n.max_depth&&n.max_depth<a)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1;i=this.get_node(i.parent),n=this.get_rules(i),a++}while(i)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var t=this.get_type(e,!0);return t.max_depth===k&&(t.max_depth=-1),t.max_children===k&&(t.max_children=-1),t.valid_children===k&&(t.valid_children=-1),t},this.get_type=function(e,t){return!!(e=this.get_node(e))&&(t?O.extend({type:e.type},this.settings.types[e.type]):e.type)},this.set_type=function(e,t){var i,r,s,n,a;if(O.isArray(e)){for(r=0,s=(e=e.slice()).length;r<s;r++)this.set_type(e[r],t);return!0}return i=this.settings.types,e=this.get_node(e),!(!i[t]||!e)&&(n=e.type,a=this.get_icon(e),e.type=t,(!0===a||i[n]&&i[n].icon!==k&&a===i[n].icon)&&this.set_icon(e,i[t].icon===k||i[t].icon),!0)}},O.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},O.jstree.plugins.unique=function(e,u){this.check=function(e,t,i,r,s){if(!1===u.check.call(this,e,t,i,r,s))return!1;if(t=t&&t.id?t:this.get_node(t),!(i=i&&i.id?i:this.get_node(i))||!i.children)return!0;var n,a,o="rename_node"===e?r:t.text,d=[],c=this.settings.unique.case_sensitive,l=this._model.data;for(n=0,a=i.children.length;n<a;n++)d.push(c?l[i.children[n]].text:l[i.children[n]].text.toLowerCase());switch(c||(o=o.toLowerCase()),e){case"delete_node":return!0;case"rename_node":return(n=-1===O.inArray(o,d)||t.text&&t.text[c?"toString":"toLowerCase"]()===o)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+o+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),n;case"create_node":return(n=-1===O.inArray(o,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+o+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),n;case"copy_node":return(n=-1===O.inArray(o,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+o+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),n;case"move_node":return(n=t.parent===i.id||-1===O.inArray(o,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+o+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),n}return!0},this.create_node=function(e,t,i,r,s){if(!t||t.text===k){if(null===e&&(e="#"),!(e=this.get_node(e)))return u.create_node.call(this,e,t,i,r,s);if(!(i=i===k?"last":i).toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(e))return u.create_node.call(this,e,t,i,r,s);t||(t={});var n,a,o,d,c,l=this._model.data,h=this.settings.unique.case_sensitive,_=this.settings.unique.duplicate;for(a=n=this.get_string("New node"),o=[],d=0,c=e.children.length;d<c;d++)o.push(h?l[e.children[d]].text:l[e.children[d]].text.toLowerCase());for(d=1;-1!==O.inArray(h?a:a.toLowerCase(),o);)a=_.call(this,n,++d).toString();t.text=a}return u.create_node.call(this,e,t,i,r,s)}};var g=document.createElement("DIV");g.setAttribute("unselectable","on"),g.setAttribute("role","presentation"),g.className="jstree-wholerow",g.innerHTML="&#160;",O.jstree.plugins.wholerow=function(e,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",O.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",O.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",O.proxy(function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",O.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;i<r;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",O.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",O.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",O.proxy(function(e){e.preventDefault();var t=O.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});O(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t)},this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var t=O.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});O(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",O.proxy(function(e){e.stopImmediatePropagation();var t=O.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});O(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",O.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",O.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(e){if(e=i.redraw_node.apply(this,arguments)){var t=g.cloneNode(!0);-1!==O.inArray(e.id,this._data.core.selected)&&(t.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===e.id&&(t.className+=" jstree-wholerow-hovered"),e.insertBefore(t,e.childNodes[0])}return e}},function(i){if(document.registerElement&&Object&&Object.create){var e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var e,t={core:{},plugins:[]};for(e in i.jstree.plugins)i.jstree.plugins.hasOwnProperty(e)&&this.attributes[e]&&(t.plugins.push(e),this.getAttribute(e)&&JSON.parse(this.getAttribute(e))&&(t[e]=JSON.parse(this.getAttribute(e))));for(e in i.jstree.defaults.core)i.jstree.defaults.core.hasOwnProperty(e)&&this.attributes[e]&&(t.core[e]=JSON.parse(this.getAttribute(e))||this.getAttribute(e));jQuery(this).jstree(t)};try{document.registerElement("vakata-jstree",{prototype:e})}catch(s){}}}(jQuery)}var f,p,m,j,y});